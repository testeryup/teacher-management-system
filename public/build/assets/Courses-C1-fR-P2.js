import{K as H,r as v,m as D,j as e,L as I}from"./app-BzdOADVP.js";import{D as K,E as L}from"./data-table-DLuYfbTv.js";import{A as M,S as _,a as E,b as T,c as w,d as F,e as A,f as O,g as k,D as U,h as X,i as q,j as B,k as y,l as V}from"./app-layout-DJJLhKv_.js";import{B as m}from"./app-logo-icon-BkO5Ozxv.js";import{I as o}from"./input-DFu5t9Bc.js";import{L as i}from"./label-Dppx2W-H.js";import{T as $,t as a}from"./index-DxeJ8Bvu.js";import{A as Q,a as P,b as R,c as z,d as G,e as J,f as W,g as Y}from"./alert-dialog-D5ivzF93.js";import"./table-0haSWtSt.js";import"./chevron-down-CEWiBjPz.js";import"./index-CK31Y0Kf.js";import"./index-C1afcH4J.js";const Z=[{title:"Quản lý môn học",href:"/courses"}];function ee({course:c,departments:x}){const[b,p]=v.useState(!1),[j,t]=v.useState(!1),[d,u]=v.useState(!1),{data:l,setData:r,put:g,processing:h,reset:C}=D({name:c.name,credits:c.credits,lessons:c.lessons,department_id:c.department_id,course_coefficient:c.course_coefficient}),{delete:N}=D(),f=()=>{N(route("courses.destroy",c.id),{onSuccess:()=>{a.success("Xóa môn học thành công"),u(!1)},onError:()=>{a.error("Xóa môn học thất bại")}})},n=s=>{s.preventDefault(),g(route("courses.update",c.id),{onSuccess:()=>{a.success("Cập nhật môn học thành công"),t(!1),C()},onError:S=>{S.department_id?a.error(S.department_id):a.error("Cập nhật môn học thất bại")}})};return e.jsxs(e.Fragment,{children:[e.jsxs(U,{open:b,onOpenChange:p,children:[e.jsx(X,{asChild:!0,children:e.jsxs(m,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Mở menu"}),e.jsx(L,{className:"h-4 w-4"})]})}),e.jsxs(q,{align:"end",children:[e.jsx(B,{children:"Hành động"}),e.jsx(y,{onSelect:s=>{s.preventDefault(),p(!1),setTimeout(()=>t(!0),300)},children:"Chỉnh sửa"}),e.jsx(V,{}),e.jsx(y,{onClick:s=>{s.preventDefault(),p(!1),setTimeout(()=>u(!0),300)},className:"text-red-600",children:"Xóa"})]})]}),e.jsx(_,{open:j,onOpenChange:t,children:e.jsxs(T,{className:"w-[500px]",children:[e.jsxs(w,{children:[e.jsx(F,{children:"Chỉnh sửa môn học"}),e.jsx(A,{children:"Cập nhật thông tin môn học"})]}),e.jsxs("form",{onSubmit:n,className:"space-y-4 p-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"update-name",children:"Tên môn học"}),e.jsx(o,{id:"update-name",value:l.name,onChange:s=>r("name",s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"update-credits",children:"Số tín chỉ"}),e.jsx(o,{id:"update-credits",type:"number",min:"1",max:"10",value:l.credits,onChange:s=>r("credits",parseInt(s.target.value)||1)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"update-lessons",children:"Số tiết học"}),e.jsx(o,{id:"update-lessons",type:"number",min:"1",value:l.lessons,onChange:s=>r("lessons",parseInt(s.target.value)||1)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"update-coefficient",children:"Hệ số học phần (1.0 - 1.5)"}),e.jsx(o,{id:"update-coefficient",type:"number",step:"0.1",min:"1.0",max:"1.5",value:l.course_coefficient,onChange:s=>r("course_coefficient",parseFloat(s.target.value)||1)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"update-department",children:"Khoa"}),e.jsxs("select",{id:"update-department",value:l.department_id||"",onChange:s=>r("department_id",s.target.value?parseInt(s.target.value):null),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Chọn khoa"}),x.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(O,{children:[e.jsx(k,{asChild:!0,children:e.jsx(m,{variant:"outline",children:"Hủy"})}),e.jsx(m,{onClick:n,disabled:h,children:h?"Đang cập nhật...":"Cập nhật"})]})]})}),e.jsx(Q,{open:d,onOpenChange:u,children:e.jsxs(P,{children:[e.jsxs(R,{children:[e.jsx(z,{children:"Xác nhận xóa"}),e.jsxs(G,{children:['Bạn có chắc chắn muốn xóa môn học "',c.name,'"? Hành động này không thể hoàn tác.']})]}),e.jsxs(J,{children:[e.jsx(W,{children:"Hủy"}),e.jsx(Y,{onClick:f,disabled:h,children:h?"Đang xóa...":"Xóa"})]})]})})]})}function pe({courses:c,departments:x}){var f;const{props:b}=H();(f=b.auth)==null||f.user;const[p,j]=v.useState(!1),{data:t,setData:d,post:u,processing:l,errors:r,reset:g}=D({name:"",credits:1,lessons:1,department_id:null,course_coefficient:1}),h=[{accessorKey:"code",header:"Mã môn học"},{accessorKey:"name",header:"Tên môn học"},{accessorKey:"credits",header:"Số tín chỉ"},{accessorKey:"lessons",header:"Số tiết học"},{accessorKey:"course_coefficient",header:"Hệ số học phần",cell:({row:n})=>{const s=n.getValue("course_coefficient");return e.jsx("span",{className:`font-medium px-2 py-1 rounded text-sm ${s>=1.4?"bg-red-100 text-red-800":s>=1.2?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:s})}},{accessorKey:"department",header:"Khoa",cell:({row:n})=>{const s=n.getValue("department");return e.jsx("div",{children:(s==null?void 0:s.abbrName)||"Chưa phân khoa"})}},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Hành động"}),cell:({row:n})=>{const s=n.original;return e.jsx("div",{className:"text-center",children:e.jsx(ee,{course:s,departments:x})})}}],C=n=>{if(n.preventDefault(),!t.name.trim()){a.error("Tên môn học là bắt buộc");return}if(!t.credits||t.credits<1||t.credits>10){a.error("Số tín chỉ phải từ 1 đến 10");return}if(!t.lessons||t.lessons<1){a.error("Số tiết học phải lớn hơn 0");return}if(!t.course_coefficient||t.course_coefficient<1||t.course_coefficient>1.5){a.error("Hệ số môn học phải từ 1.0 đến 1.5");return}u(route("courses.store"),{onSuccess:()=>{a.success("Thêm môn học mới thành công"),g(),j(!1)},onError:s=>{console.log("Course errors:",s),s.name?a.error(`Lỗi tên môn học: ${s.name}`):s.code?a.error(`Lỗi mã môn học: ${s.code}`):s.department_id?a.error(s.department_id):a.error("Thêm môn học mới thất bại")}})},N=n=>{j(n),n||g()};return e.jsxs(M,{breadcrumbs:Z,children:[e.jsx($,{}),e.jsx(I,{title:"Quản lý môn học"}),e.jsxs("div",{className:"m-4",children:[e.jsxs(_,{open:p,onOpenChange:N,children:[e.jsx(E,{asChild:!0,children:e.jsx(m,{className:"mb-4 cursor-pointer",children:"Thêm môn học mới"})}),e.jsxs(T,{className:"w-[500px]",children:[e.jsxs(w,{children:[e.jsx(F,{children:"Thêm môn học mới"}),e.jsx(A,{children:"Nhập thông tin môn học ở đây, sau đó nhấn lưu"})]}),e.jsx("form",{onSubmit:C,id:"course-form",className:"space-y-6 p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"name",children:"Tên môn học *"}),e.jsx(o,{id:"name",value:t.name,onChange:n=>d("name",n.target.value),placeholder:"VD: Lập trình cơ bản",required:!0}),r.name&&e.jsx("p",{className:"text-sm text-red-500",children:r.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"credits",children:"Số tín chỉ *"}),e.jsx(o,{id:"credits",type:"number",min:"1",max:"10",value:t.credits,onChange:n=>d("credits",parseInt(n.target.value)||1),required:!0}),r.credits&&e.jsx("p",{className:"text-sm text-red-500",children:r.credits})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"lessons",children:"Số tiết học *"}),e.jsx(o,{id:"lessons",type:"number",min:"1",value:t.lessons,onChange:n=>d("lessons",parseInt(n.target.value)||1),required:!0}),r.lessons&&e.jsx("p",{className:"text-sm text-red-500",children:r.lessons})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"course_coefficient",children:"Hệ số học phần (1.0 - 1.5) *"}),e.jsx(o,{id:"course_coefficient",type:"number",step:"0.1",min:"1.0",max:"1.5",value:t.course_coefficient,onChange:n=>d("course_coefficient",parseFloat(n.target.value)||1),required:!0}),r.course_coefficient&&e.jsx("p",{className:"text-sm text-red-500",children:r.course_coefficient})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{htmlFor:"department_id",children:"Khoa"}),e.jsxs("select",{id:"department_id",value:t.department_id||"",onChange:n=>d("department_id",n.target.value?parseInt(n.target.value):null),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Chọn khoa"}),x.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),r.department_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.department_id})]})]})}),e.jsxs(O,{children:[e.jsx(k,{asChild:!0,children:e.jsx(m,{variant:"outline",type:"button",className:"cursor-pointer",children:"Thoát"})}),e.jsx(m,{type:"submit",form:"course-form",className:"cursor-pointer",disabled:l,children:l?"Đang xử lý...":"Thêm mới"})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(K,{columns:h,data:c.data,searchKey:"name",searchPlaceholder:"Tìm kiếm môn học..."})})]})]})}export{pe as default};
