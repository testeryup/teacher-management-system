import{j as e,r as y,m as M,L as z,S as p}from"./app-BzdOADVP.js";import{A as $,m as N,F as v,D as X,h as O,i as R,k as _}from"./app-layout-DJJLhKv_.js";import{c as H,a as P,B as i}from"./app-logo-icon-BkO5Ozxv.js";import{I as K}from"./input-DFu5t9Bc.js";import{L as k}from"./label-Dppx2W-H.js";import{B as Q}from"./badge-D3QJI1i6.js";import{C as Y,a as G,b as q,d as J,c as U}from"./card-Cs6Ji-ep.js";import{A as w,a as T,b as C}from"./alert-DjTGgkbr.js";import{T as W,t as a}from"./index-DxeJ8Bvu.js";import{D as Z,a as ee,b as se,g as ne,c as ae,d as te,e as le}from"./dialog-CWXE0-pn.js";import{T as re,a as ce,b as D,c as m,d as ie,e as u}from"./table-0haSWtSt.js";import{P as oe,R as he}from"./refresh-cw-C2KkqmM1.js";import{C as de}from"./calculator-BGAZN5Ev.js";import{D as S}from"./download-CFjlwEKO.js";import{C as me}from"./chevron-down-CEWiBjPz.js";import{E as ue}from"./eye-fIjAslyx.js";import"./index-CK31Y0Kf.js";import"./index-C1afcH4J.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ge=H("Info",xe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],pe=H("Lock",je);function be({value:x,onValueChange:o,options:b,placeholder:h="Chọn...",className:r,disabled:g=!1}){return e.jsxs("select",{value:x,onChange:c=>o(c.target.value),disabled:g,className:P("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),children:[e.jsx("option",{value:"",children:h}),b.map(c=>e.jsxs("option",{value:c.value,children:[c.label," ",c.sublabel&&`- ${c.sublabel}`]},c.value))]})}const Ne=[{title:"Tính lương giáo viên",href:"/salary"}];function Me({salaryConfigs:x,semesters:o}){const[b,h]=y.useState(!1),{data:r,setData:g,post:c,processing:d,errors:j,reset:A}=M({semester_id:"",base_salary_per_lesson:5e4}),V=y.useMemo(()=>o.map(s=>{var n;return{value:s.id.toString(),label:s.name,sublabel:((n=s.academicYear)==null?void 0:n.name)||"N/A"}}),[o]),f=s=>{if(s.preventDefault(),!r.semester_id){a.error("Vui lòng chọn học kỳ");return}if(!r.base_salary_per_lesson||r.base_salary_per_lesson<=0){a.error("Vui lòng nhập tiền dạy một tiết hợp lệ");return}if(r.base_salary_per_lesson>5e5){a.error("Tiền dạy một tiết không được lớn hơn 500k");return}c(route("salary.store"),{onSuccess:()=>{a.success("Tạo cấu hình lương thành công!"),A(),h(!1)},onError:n=>{console.error("Validation errors:",n),n.semester_id?a.error(`Lỗi học kỳ: ${n.semester_id}`):n.base_salary_per_lesson?a.error(`Lỗi tiền/tiết: ${n.base_salary_per_lesson}`):a.error("Tạo cấu hình lương thất bại")}})},B=s=>{var t;const n=((t=s.semester)==null?void 0:t.name)||"N/A";confirm(`Bạn có chắc muốn tính lương cho học kỳ ${n}?

Hệ thống sẽ tính lương cho tất cả lớp học có giáo viên trong học kỳ này.`)&&p.post(route("salary.calculate",s.id),{},{onSuccess:()=>{a.success("Tính lương thành công!")},onError:l=>{console.error("Calculation errors:",l),l.status?a.error(l.status):l.calculation?a.error(l.calculation):a.error("Tính lương thất bại")}})},I=s=>{var t;const n=((t=s.semester)==null?void 0:t.name)||"N/A";confirm(`⚠️ CẢNH BÁO: Tính lại lương cho học kỳ ${n}?

• Dữ liệu lương cũ sẽ bị XÓA và tính lại từ đầu
• Hành động này KHÔNG THỂ hoàn tác

Bạn có chắc chắn muốn tiếp tục?`)&&p.post(route("salary.calculate",s.id),{},{onSuccess:()=>{a.success("Tính lại lương thành công!")},onError:l=>{l.status?a.error(l.status):l.calculation?a.error(l.calculation):a.error("Tính lại lương thất bại")}})},L=s=>{var t;const n=((t=s.semester)==null?void 0:t.name)||"N/A";confirm(`Bạn có chắc muốn đóng bảng lương học kỳ ${n}?

Sau khi đóng sẽ không thể tính lại hoặc sửa đổi được nữa.`)&&p.patch(route("salary.close",s.id),{},{onSuccess:()=>{a.success("Đã đóng bảng lương")},onError:()=>{a.error("Đóng bảng lương thất bại")}})},F=s=>{const t={draft:{label:"Bản nháp",className:"bg-gray-100 text-gray-800"},active:{label:"Đã tính",className:"bg-green-100 text-green-800"},closed:{label:"Đã đóng",className:"bg-red-100 text-red-800"}}[s];return e.jsx(Q,{className:t.className,children:t.label})},E=s=>{var n;return s?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:((n=s.academicYear)==null?void 0:n.name)||"N/A"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"N/A"})]})};return e.jsxs($,{breadcrumbs:Ne,children:[e.jsx(W,{position:"top-right"}),e.jsx(z,{title:"Tính lương giáo viên"}),e.jsxs("div",{className:"container mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(N,{className:"h-6 w-6 text-blue-600"})}),"Tính lương giáo viên"]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Quản lý và tính toán lương giảng dạy theo từng học kỳ"})]}),e.jsxs(Z,{open:b,onOpenChange:h,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(i,{size:"lg",disabled:o.length===0,className:"shadow-md",children:[e.jsx(oe,{className:"w-5 h-5 mr-2"}),"Tạo cấu hình lương"]})}),e.jsxs(se,{className:"sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5 text-blue-600"}),"Tạo cấu hình lương mới"]}),e.jsx(te,{children:"Chọn học kỳ và thiết lập mức lương cơ bản cho giảng viên"})]}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"semester_id",className:"text-sm font-medium",children:"Học kỳ *"}),e.jsx(be,{value:r.semester_id,onValueChange:s=>g("semester_id",s),options:V,placeholder:"Chọn học kỳ",disabled:d}),j.semester_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:j.semester_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"base_salary_per_lesson",className:"text-sm font-medium",children:"Tiền dạy một tiết (VND) *"}),e.jsx(K,{id:"base_salary_per_lesson",type:"number",min:"0",step:"1000",value:r.base_salary_per_lesson,onChange:s=>g("base_salary_per_lesson",parseInt(s.target.value)||0),placeholder:"50,000",className:"text-right",disabled:d}),j.base_salary_per_lesson&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:j.base_salary_per_lesson}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-700 font-medium",children:["Hiển thị: ",new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r.base_salary_per_lesson||0)]})})]})]}),e.jsxs(le,{children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>h(!1),disabled:d,children:"Hủy"}),e.jsx(i,{onClick:f,disabled:d,className:"min-w-[100px]",children:d?"Đang tạo...":"Tạo mới"})]})]})]})]}),e.jsxs(w,{children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(T,{children:"Hướng dẫn sử dụng"}),e.jsx(C,{children:e.jsxs("ol",{className:"list-decimal list-inside space-y-1 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Tạo cấu hình:"})," Chọn học kỳ và nhập tiền dạy một tiết"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tính lương:"}),' Nhấn "Tính lương" để tính toán cho tất cả giáo viên']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Xem báo cáo:"})," Xem chi tiết lương của từng giáo viên"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Đóng bảng lương:"})," Đóng để khóa không cho sửa đổi"]})]})})]}),o.length===0&&e.jsxs(w,{variant:"destructive",children:[e.jsx(T,{children:"Không có học kỳ khả dụng"}),e.jsx(C,{children:"Tất cả học kỳ đã có cấu hình lương hoặc chưa có học kỳ nào được tạo. Vui lòng tạo học kỳ mới hoặc kiểm tra lại các cấu hình hiện có."})]}),e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Danh sách cấu hình lương"]}),e.jsx(J,{children:"Quản lý các cấu hình lương theo từng học kỳ"})]}),e.jsx(U,{children:x.data.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(re,{children:[e.jsx(ce,{children:e.jsxs(D,{children:[e.jsx(m,{className:"w-[200px]",children:"Học kỳ"}),e.jsx(m,{children:"Tiền/tiết"}),e.jsx(m,{children:"Trạng thái"}),e.jsx(m,{children:"Ngày tạo"}),e.jsx(m,{className:"text-right",children:"Hành động"})]})}),e.jsx(ie,{children:x.data.map(s=>e.jsxs(D,{children:[e.jsx(u,{children:E(s.semester)}),e.jsx(u,{children:e.jsx("span",{className:"font-mono font-medium",children:new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s.base_salary_per_lesson)})}),e.jsx(u,{children:F(s.status)}),e.jsx(u,{children:new Date(s.created_at).toLocaleDateString("vi-VN")}),e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[s.status==="draft"&&e.jsxs(i,{size:"sm",onClick:()=>B(s),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Tính lương"]}),(s.status==="active"||s.status==="closed")&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>p.visit(route("salary.report",s.id)),children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),"Xem báo cáo"]}),e.jsxs(X,{children:[e.jsx(O,{asChild:!0,children:e.jsxs(i,{size:"sm",variant:"outline",children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"Xuất file",e.jsx(me,{className:"w-3 h-3 ml-1"})]})}),e.jsxs(R,{align:"end",children:[e.jsxs(_,{onClick:()=>window.open(route("salary.preview-pdf",s.id),"_blank"),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Xem trước PDF"]}),e.jsxs(_,{onClick:()=>window.location.href=route("salary.export-pdf",s.id),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Tải PDF"]})]})]})]}),s.status==="active"&&e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>I(s),className:"border-orange-500 text-orange-600 hover:bg-orange-50",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"Tính lại"]}),s.status==="active"&&e.jsxs(i,{size:"sm",variant:"destructive",onClick:()=>L(s),children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Đóng"]})]})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Chưa có cấu hình lương nào"}),e.jsx("p",{className:"text-muted-foreground",children:"Tạo cấu hình lương đầu tiên để bắt đầu tính toán lương giảng viên."})]})})]})]})]})}export{Me as default};
