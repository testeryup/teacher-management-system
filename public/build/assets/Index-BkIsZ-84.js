import{K as J,m as W,r as c,j as e,L as Y}from"./app-BzdOADVP.js";import{A as Z,S as ee,a as se,b as ae,c as ne,d as le,e as re,f as te,g as ie}from"./app-layout-DJJLhKv_.js";import{c as oe,B as p}from"./app-logo-icon-BkO5Ozxv.js";import{T as de}from"./sonner-C79GmkCj.js";import{t as n}from"./index-DxeJ8Bvu.js";import{I as g}from"./input-DFu5t9Bc.js";import{L as d}from"./label-Dppx2W-H.js";import{P as ce}from"./pagination-BB0cugiz.js";import{T as I,a as E,b as k,c as t,d as he,e as h}from"./table-0haSWtSt.js";import{A as me,a as pe,b as xe,c as ge,d as ue,e as je,f as fe,g as Ne}from"./alert-dialog-D5ivzF93.js";import{E as A}from"./eye-fIjAslyx.js";import"./index-CK31Y0Kf.js";import"./index-C1afcH4J.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],F=oe("EyeOff",ve),be=[{title:"Quản lý giáo viên",href:"/teachers"}];function Le({teachers:x,degrees:L,departments:H}){var O;(O=J().props)==null||O.flash;const{data:l,setData:i,post:P,processing:m,errors:r,reset:f,delete:X,put:K}=W({fullName:"",DOB:new Date().toISOString().split("T")[0],phone:"",email:"",department_id:null,degree_id:null,password:"",password_confirmation:"",role:"teacher"}),[M,u]=c.useState(!1),[y,S]=c.useState(null),[$,D]=c.useState(null),[_,N]=c.useState(null),[U,j]=c.useState(!1),[o,v]=c.useState(!1),[b,C]=c.useState(!1),[w,T]=c.useState(!1),R=(s,a)=>{S(s),D(a),j(!0)},V=()=>{y!==null&&X(route("teachers.destroy",y),{onSuccess:()=>{n.success("Xóa giáo viên thành công"),j(!1),S(null),D(null)},onError:s=>{console.log("Delete errors:",s),s.reference?n.error(s.reference):s.permission?n.error(s.permission):n.error("Không thể xóa giáo viên"),j(!1)}})},z=s=>/^[0-9]{10,11}$/.test(s),Q=s=>{if(s.preventDefault(),!l.fullName.trim()){n.error("Họ tên là bắt buộc");return}if(!z(l.phone)){n.error("Số điện thoại chỉ được chứa số và có độ dài 10-11 chữ số");return}if(!l.email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)){n.error("Email không hợp lệ");return}if(!l.department_id){n.error("Vui lòng chọn khoa");return}if(!l.degree_id){n.error("Vui lòng chọn bằng cấp");return}if(o){if(l.password&&l.password.length<8){n.error("Mật khẩu phải có ít nhất 8 ký tự");return}if(l.password&&l.password!==l.password_confirmation){n.error("Xác nhận mật khẩu không khớp");return}}else{if(!l.password||l.password.length<8){n.error("Mật khẩu phải có ít nhất 8 ký tự");return}if(l.password!==l.password_confirmation){n.error("Xác nhận mật khẩu không khớp");return}}o?_!==null&&K(route("teachers.update",_),{onSuccess:()=>{n.success("Cập nhật giáo viên thành công"),f(),u(!1),v(!1),N(null)},onError:a=>{console.log("Teacher update errors:",a),a.phone?n.error(`Lỗi SDT: ${a.phone}`):a.email?n.error(`Lỗi email: ${a.email}`):a.department_id?n.error(a.department_id):a.permission?n.error(a.permission):a.password?n.error(a.password):a.error?n.error(a.error):n.error("Cập nhật giáo viên thất bại")}}):P(route("teachers.store"),{onSuccess:()=>{n.success("Thêm giáo viên và tài khoản thành công"),f(),u(!1)},onError:a=>{console.log("Teacher store errors:",a),a.phone?n.error(`Lỗi SDT: ${a.phone}`):a.email?n.error(`Lỗi email: ${a.email}`):a.department_id?n.error(a.department_id):a.password?n.error(a.password):a.role?n.error(a.role):a.error?n.error(a.error):n.error("Thêm giáo viên mới thất bại")}})};function G(s){v(!0),i({fullName:s.fullName,DOB:typeof s.DOB=="object"?s.DOB.toISOString().split("T")[0]:String(s.DOB),phone:s.phone,email:s.email,department_id:s.department_id,degree_id:s.degree_id,password:"",password_confirmation:"",role:"teacher"}),N(s.id),u(!0)}const q=s=>{u(s),s||(f(),v(!1),N(null),C(!1),T(!1))};return e.jsxs(Z,{breadcrumbs:be,children:[e.jsx(de,{}),e.jsx(Y,{title:"Quản lý giáo viên"}),e.jsx("div",{className:"m-4",children:e.jsxs(ee,{open:M,onOpenChange:q,children:[e.jsx(se,{asChild:!0,children:e.jsx(p,{variant:"default",className:"hover:cursor-pointer",children:"Thêm giáo viên mới"})}),e.jsxs(ae,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:o?"Chỉnh sửa thông tin giáo viên":"Thêm giáo viên mới"}),e.jsx(re,{children:o?"Cập nhật thông tin giáo viên. Để trống mật khẩu nếu không muốn thay đổi.":"Nhập thông tin giáo viên và tạo tài khoản đăng nhập."})]}),e.jsx("form",{onSubmit:Q,id:"teacher-form",className:"space-y-6 p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"fullName",children:["Tên giáo viên ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{id:"fullName",value:l.fullName,onChange:s=>i("fullName",s.target.value),className:"w-full",placeholder:"Nhập họ tên đầy đủ"}),r.fullName&&e.jsx("p",{className:"text-sm text-red-500",children:r.fullName})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"DOB",children:["Ngày sinh ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{id:"DOB",value:l.DOB,onChange:s=>i("DOB",s.target.value),type:"date",className:"w-full"}),r.DOB&&e.jsx("p",{className:"text-sm text-red-500",children:r.DOB})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"phone",children:["Số điện thoại ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{id:"phone",value:l.phone,onChange:s=>{const a=s.target.value.replace(/[^0-9]/g,"");a.length<=11&&i("phone",a)},placeholder:"0123456789",pattern:"[0-9]{10,11}",maxLength:11,className:"w-full"}),r.phone&&e.jsx("p",{className:"text-sm text-red-500",children:r.phone})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"email",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(g,{id:"email",type:"email",value:l.email,onChange:s=>i("email",s.target.value),className:"w-full",placeholder:"email@example.com"}),r.email&&e.jsx("p",{className:"text-sm text-red-500",children:r.email})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"department_id",children:["Khoa ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"department_id",value:l.department_id||"",onChange:s=>i("department_id",s.target.value?parseInt(s.target.value):null),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Chọn khoa"}),H.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.abbrName,")"]},s.id))]}),r.department_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.department_id})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"degree_id",children:["Bằng cấp ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"degree_id",value:l.degree_id||"",onChange:s=>i("degree_id",s.target.value?parseInt(s.target.value):null),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Chọn bằng cấp"}),L.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (Hệ số: ",s.baseSalaryFactor,")"]},s.id))]}),r.degree_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.degree_id})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"role",children:["Vai trò ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"role",value:l.role,onChange:s=>i("role",s.target.value),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"teacher",children:"Giảng viên"}),e.jsx("option",{value:"department_head",children:"Trưởng khoa"}),e.jsx("option",{value:"accountant",children:"Kế toán"})]}),r.role&&e.jsx("p",{className:"text-sm text-red-500",children:r.role})]}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(d,{className:"text-sm font-medium",children:o?"Đổi mật khẩu (tùy chọn)":"Tạo tài khoản đăng nhập"})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"password",children:["Mật khẩu ",!o&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"password",type:b?"text":"password",value:l.password,onChange:s=>i("password",s.target.value),placeholder:o?"Để trống nếu không đổi":"Nhập mật khẩu (tối thiểu 8 ký tự)",className:"pr-10"}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>C(!b),children:b?e.jsx(F,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]}),r.password&&e.jsx("p",{className:"text-sm text-red-500",children:r.password})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(d,{htmlFor:"password_confirmation",children:["Xác nhận mật khẩu ",!o&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"password_confirmation",type:w?"text":"password",value:l.password_confirmation,onChange:s=>i("password_confirmation",s.target.value),placeholder:o?"Để trống nếu không đổi":"Nhập lại mật khẩu",className:"pr-10"}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>T(!w),children:w?e.jsx(F,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]}),r.password_confirmation&&e.jsx("p",{className:"text-sm text-red-500",children:r.password_confirmation})]})]})]})}),e.jsxs(te,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(p,{variant:"outline",type:"button",className:"hover:cursor-pointer",children:"Thoát"})}),e.jsx(p,{type:"submit",form:"teacher-form",disabled:m,className:"hover:cursor-pointer",children:m?"Đang xử lý...":o?"Cập nhật":"Thêm mới"})]})]})]})}),x.data.length>0?e.jsx("div",{className:"m-4",children:e.jsxs(I,{children:[e.jsx(E,{children:e.jsxs(k,{children:[e.jsx(t,{className:"w-[100px]",children:"Id"}),e.jsx(t,{children:"Tên giáo viên"}),e.jsx(t,{children:"Ngày sinh"}),e.jsx(t,{children:"Số điện thoại"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Khoa"}),e.jsx(t,{children:"Bằng cấp"}),e.jsx(t,{className:"text-center",children:"Hành động"})]})}),e.jsx(he,{children:x.data.map(s=>{var a,B;return e.jsxs(k,{children:[e.jsx(h,{className:"font-medium",children:s.id}),e.jsx(h,{children:s.fullName}),e.jsx(h,{children:s.DOB?new Date(s.DOB).toLocaleDateString("vi-VN"):""}),e.jsx(h,{children:s.phone}),e.jsx(h,{children:s.email}),e.jsx(h,{children:((a=s.department)==null?void 0:a.abbrName)||"-"}),e.jsx(h,{children:((B=s.degree)==null?void 0:B.name)||"-"}),e.jsxs(h,{className:"text-center space-x-2",children:[e.jsx(p,{disabled:m,onClick:()=>G(s),className:"bg-yellow-500 hover:bg-yellow-700 hover:cursor-pointer",children:"Sửa"}),e.jsx(p,{disabled:m,onClick:()=>R(s.id,s.fullName),className:"bg-red-500 hover:bg-red-700 hover:cursor-pointer",children:"Xoá"})]})]},s.id)})})]})}):e.jsx("div",{className:"m-4",children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(k,{children:[e.jsx(t,{className:"w-[100px]",children:"Id"}),e.jsx(t,{children:"Tên giáo viên"}),e.jsx(t,{children:"Ngày sinh"}),e.jsx(t,{children:"Số điện thoại"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Khoa"}),e.jsx(t,{children:"Bằng cấp"}),e.jsx(t,{className:"text-center",children:"Hành động"})]})})})}),e.jsx("div",{className:"mx-4",children:e.jsx(ce,{links:x.links,from:x.from,to:x.to,total:x.total})}),e.jsx(me,{open:U,onOpenChange:j,children:e.jsxs(pe,{children:[e.jsxs(xe,{children:[e.jsx(ge,{children:"Xác nhận xoá"}),e.jsxs(ue,{children:["Bạn có chắc chắn muốn xoá giáo viên ",e.jsx("strong",{children:$})," không?",e.jsx("br",{}),e.jsx("span",{className:"text-red-600 font-medium",children:"Hành động này sẽ xóa cả tài khoản đăng nhập và không thể hoàn tác."})]})]}),e.jsxs(je,{children:[e.jsx(fe,{className:"hover:cursor-pointer",disabled:m,children:"Huỷ"}),e.jsx(Ne,{className:"hover:cursor-pointer",onClick:V,disabled:m,children:m?"Đang xóa...":"Xác nhận"})]})]})})]})}export{Le as default};
